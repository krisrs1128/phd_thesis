\chapter{Supplementary Figures for Inference of Dynamic Regimes}
\label{ch:dynamic_regimes_supp}

This appendix contains figures that complement those in Chapter
\ref{ch:dynamic_regimes}.

\begin{figure}
  \centering
  \includegraphics[width=0.9\textwidth]{figure/regime_detection/heatmap-mix}
  \caption{
    The analog of Figures \ref{fig:heatmap-euclidean} and
    \ref{fig:heatmap-jaccard}, obtained by using a distance that mixes between
    the two: $d\left(x_i, x_{i^{\prime}}\right) = 0.5 d_{\text{Euc}}\left(x_{i},
    x_{i^{\prime}}\right) + 0.5d_{\text{Jac}}\left(x_{i}, x_{i^\prime}\right)$.
    Species now must have both nearby abundances and similar zero patterns, in
    order to appear as neighboring columns in this heatmap.
    \label{fig:heatmap-mix} }
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=0.9\textwidth]{figure/regime_detection/heatmap-innovations}
  \caption{
    A version of Figure \ref{fig:heatmap-euclidean} obtained after clustering on
    the first-differenced series. The shading of cells now corresponds to
    increases (green) or decreases (red) in abundance between neighboring
    timepoints. Species are now considered similar as long as they have similar
    changes from time to time, even when their absolute abundances may not be
    close.
    \label{fig:heatmap-innovations} }
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=0.9\textwidth]{figure/regime_detection/heatmap-innovations-bin}
  \caption{
    The idea in Figure \ref{fig:heatmap-innovations} of comparing first
    differenced series can be coarsened to simply studying whether series
    increased or decreased between neighboring timepoints, ignoring the actual
    value. By computing Manhattan distances between these coarsened differences,
    we can achieve an effect similar to viewing Jaccard distances on the
    original abundances.
    \label{fig:heatmap-innovations-bin} }
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=0.9\textwidth]{figure/regime_detection/rpart_simple}
  \caption{A version of Figure \ref{fig:rpart_complex} made when the penalty $k$
    for having complex trees is very low. The resulting partition is generally
    too rough to be useful, though certain structures -- like the increase in
    abundance among some species during the first antibiotic time course for
    subject D -- to become more visible. In a purely supervised setting, this
    model would be quite overfit, and though we are now applying models for
    exploratory analysis, a similar principle applies.
    \label{fig:rpart_simple}
  }
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=0.9\textwidth]{figure/regime_detection/rpart_complex_2}
  \caption{
    A version of Figure \ref{fig:rpart_complex} with much more penalty on the
    complexity of the learned partitions. While Supplementary
    Figure \ref{fig:rpart_simple} displayed a very overfit tree, the tree here
    seems quite underfit, as only a few leaves seem to have survived the pruning
    process. Between this figure and the two mentioned before, we can get a
    sense of the degree to which model tuning can affect visual interpretation.
    \label{fig:rpart_complex_2} }
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=0.9\textwidth]{figure/regime_detection/rpart_binary_simple}
  \caption{CART partitions across species and timepoints. Each column here
    corresponds to an Amplicon Sequence Variant (ASV), and rows are timepoints.
    The three subjects (D, E, and F) are laid out side by side. Each rectangle
    in the figure represents the leaf node for a CART model fitted on
    presence-absence data, shaded by the fitted probability of being present in
    a given species by timepoint combination.
    \label{fig:rpart_binary_simple}}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=0.9\textwidth]{figure/regime_detection/rpart_conditional}
  \caption{CART partitions when predicting abundances for species $\times$
    timepoint combinations, using a model trained on only nonzero cells of the
    species abundance matrix. The resulting fit can be interpreted as the
    predicted abundance conditional on being present, as in a standard hurdle
    model. \label{fig:rpart_conditional} }
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=0.9\textwidth]{figure/regime_detection/hmm_probs}
  \caption{Fitted probabilities for each of the $K = 4$ states in the HMM
    estimated by EM. Different rows of panels correspond to different
    individuals, while different columns are different states. The colors across
    columns represent the emission means for the associated states, while the
    transparency of a cell in a certain column corresponds to the probability
    that cell was generated by that column's state. \label{fig:hmm_probs} }
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=\textwidth]{figure/regime_detection/bayes_gibbs_samples}
  \caption{State mixing for the sticky HMM. Each panel represents a separate
    species. Within each panel, columns indicate timepoints, while rows give
    states $z_{it}$ at every $20^{th}$ Gibbs sampling iteration, sorted from
    early (bottom) to late (top). Each color represents a different state. After
    an initial burn-in, most timepoints seem to have a relatively fixed
    state. \label{fig:bayes_gibbs_samples} }
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=\textwidth]{figure/regime_detection/hdp_gibbs_samples}
  \caption{
    A summary of state mixing for the sticky HDP-HMM, read in the same as Figure
    \ref{fig:bayes_gibbs_samples}. There are more states here than for the
    sticky HMM, but nonetheless some timepoints are relatively fixed across
    Gibbs sampling iterations.
    \label{fig:hdp_gibbs_samples} }
\end{figure}
